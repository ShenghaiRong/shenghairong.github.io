<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>通过CF Worker代理第三方api在Cursor中使用Claude | Shawn's Blog</title>
<meta name=keywords content="tutorial"><meta name=description content="在 Cursor 中使用 Cloudflare Worker 代理以第三方api的方式访问 Claude 教程
本教程将指导你如何通过 Cloudflare Worker 在 Cursor 中以第三方api的方式访问 Claude 和 Deepseek 模型。通过覆盖 OpenAI 的 URL 地址，我们可以使用 第三方api 来访问这些模型。
功能特点

支持 OpenAI 的 GPT 模型
支持将请求中的 &lsquo;my-cld&rsquo; 改写为 &lsquo;claude&rsquo;（通过 第三方api 代理地址）
支持将请求中的 &lsquo;my-deepseek&rsquo; 改写为 &lsquo;deepseek&rsquo;（直接通过 Deepseek 官方 API）

详细步骤
1. 创建 Cloudflare Worker

登录到 Cloudflare Dashboard
在左侧菜单中选择 &ldquo;Workers & Pages&rdquo;
点击 &ldquo;Create Application&rdquo;
选择 &ldquo;Create Worker&rdquo;
为你的 Worker 命名，然后点击 &ldquo;Deploy&rdquo;
进入 Worker 编辑界面

2. 配置环境变量


在 Cloudflare Dashboard 中："><meta name=author content="Shawn"><link rel=canonical href=https://shenghairong.github.io/posts/2024-11-11-oneapi_cursor/><link crossorigin=anonymous href=/assets/css/stylesheet.a8b4f6acb85031cad9e897b88016add045657d84ce513eaec6ae90b7169db3af.css integrity="sha256-qLT2rLhQMcrZ6Je4gBat0EVlfYTOUT6uxq6Qtxads68=" rel="preload stylesheet" as=style><link rel=icon href=https://shenghairong.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://shenghairong.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://shenghairong.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://shenghairong.github.io/apple-touch-icon.png><link rel=mask-icon href=https://shenghairong.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://shenghairong.github.io/posts/2024-11-11-oneapi_cursor/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://shenghairong.github.io/posts/2024-11-11-oneapi_cursor/"><meta property="og:site_name" content="Shawn's Blog"><meta property="og:title" content="通过CF Worker代理第三方api在Cursor中使用Claude"><meta property="og:description" content="在 Cursor 中使用 Cloudflare Worker 代理以第三方api的方式访问 Claude 教程 本教程将指导你如何通过 Cloudflare Worker 在 Cursor 中以第三方api的方式访问 Claude 和 Deepseek 模型。通过覆盖 OpenAI 的 URL 地址，我们可以使用 第三方api 来访问这些模型。
功能特点 支持 OpenAI 的 GPT 模型 支持将请求中的 ‘my-cld’ 改写为 ‘claude’（通过 第三方api 代理地址） 支持将请求中的 ‘my-deepseek’ 改写为 ‘deepseek’（直接通过 Deepseek 官方 API） 详细步骤 1. 创建 Cloudflare Worker 登录到 Cloudflare Dashboard 在左侧菜单中选择 “Workers & Pages” 点击 “Create Application” 选择 “Create Worker” 为你的 Worker 命名，然后点击 “Deploy” 进入 Worker 编辑界面 2. 配置环境变量 在 Cloudflare Dashboard 中："><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-11T11:44:57+08:00"><meta property="article:modified_time" content="2024-11-11T11:44:57+08:00"><meta property="article:tag" content="Tutorial"><meta name=twitter:card content="summary"><meta name=twitter:title content="通过CF Worker代理第三方api在Cursor中使用Claude"><meta name=twitter:description content="在 Cursor 中使用 Cloudflare Worker 代理以第三方api的方式访问 Claude 教程
本教程将指导你如何通过 Cloudflare Worker 在 Cursor 中以第三方api的方式访问 Claude 和 Deepseek 模型。通过覆盖 OpenAI 的 URL 地址，我们可以使用 第三方api 来访问这些模型。
功能特点

支持 OpenAI 的 GPT 模型
支持将请求中的 &lsquo;my-cld&rsquo; 改写为 &lsquo;claude&rsquo;（通过 第三方api 代理地址）
支持将请求中的 &lsquo;my-deepseek&rsquo; 改写为 &lsquo;deepseek&rsquo;（直接通过 Deepseek 官方 API）

详细步骤
1. 创建 Cloudflare Worker

登录到 Cloudflare Dashboard
在左侧菜单中选择 &ldquo;Workers & Pages&rdquo;
点击 &ldquo;Create Application&rdquo;
选择 &ldquo;Create Worker&rdquo;
为你的 Worker 命名，然后点击 &ldquo;Deploy&rdquo;
进入 Worker 编辑界面

2. 配置环境变量


在 Cloudflare Dashboard 中："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://shenghairong.github.io/posts/"},{"@type":"ListItem","position":2,"name":"通过CF Worker代理第三方api在Cursor中使用Claude","item":"https://shenghairong.github.io/posts/2024-11-11-oneapi_cursor/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"通过CF Worker代理第三方api在Cursor中使用Claude","name":"通过CF Worker代理第三方api在Cursor中使用Claude","description":"在 Cursor 中使用 Cloudflare Worker 代理以第三方api的方式访问 Claude 教程 本教程将指导你如何通过 Cloudflare Worker 在 Cursor 中以第三方api的方式访问 Claude 和 Deepseek 模型。通过覆盖 OpenAI 的 URL 地址，我们可以使用 第三方api 来访问这些模型。\n功能特点 支持 OpenAI 的 GPT 模型 支持将请求中的 \u0026lsquo;my-cld\u0026rsquo; 改写为 \u0026lsquo;claude\u0026rsquo;（通过 第三方api 代理地址） 支持将请求中的 \u0026lsquo;my-deepseek\u0026rsquo; 改写为 \u0026lsquo;deepseek\u0026rsquo;（直接通过 Deepseek 官方 API） 详细步骤 1. 创建 Cloudflare Worker 登录到 Cloudflare Dashboard 在左侧菜单中选择 \u0026ldquo;Workers \u0026amp; Pages\u0026rdquo; 点击 \u0026ldquo;Create Application\u0026rdquo; 选择 \u0026ldquo;Create Worker\u0026rdquo; 为你的 Worker 命名，然后点击 \u0026ldquo;Deploy\u0026rdquo; 进入 Worker 编辑界面 2. 配置环境变量 在 Cloudflare Dashboard 中：\n","keywords":["tutorial"],"articleBody":"在 Cursor 中使用 Cloudflare Worker 代理以第三方api的方式访问 Claude 教程 本教程将指导你如何通过 Cloudflare Worker 在 Cursor 中以第三方api的方式访问 Claude 和 Deepseek 模型。通过覆盖 OpenAI 的 URL 地址，我们可以使用 第三方api 来访问这些模型。\n功能特点 支持 OpenAI 的 GPT 模型 支持将请求中的 ‘my-cld’ 改写为 ‘claude’（通过 第三方api 代理地址） 支持将请求中的 ‘my-deepseek’ 改写为 ‘deepseek’（直接通过 Deepseek 官方 API） 详细步骤 1. 创建 Cloudflare Worker 登录到 Cloudflare Dashboard 在左侧菜单中选择 “Workers \u0026 Pages” 点击 “Create Application” 选择 “Create Worker” 为你的 Worker 命名，然后点击 “Deploy” 进入 Worker 编辑界面 2. 配置环境变量 在 Cloudflare Dashboard 中：\n进入你的 Worker 的设置页面 点击 “Settings” 选项卡 找到 “Variables” 部分 点击 “Add variable” 按钮 添加以下环境变量：\nONEAPI_UPSTREAM: 你的 第三方api 代理地址 DEEPSEEK_UPSTREAM: deepseek 代理地址, 官方为 api.deepseek.com VALID_ORIGINAL_API_KEY: 你的 第三方api key DEEPSEEK_API_KEY: 你的 Deepseek API key 对于包含敏感信息的变量（API Keys），确保：\n点击 “Encrypt” 选项 设置类型为 “Secret text” 3. 配置 Worker 代码 将以下代码复制到 Worker 中： 点击查看 ▼ export default { async fetch(request, env, ctx) { return await handleRequest(request, env); } }; // 主要处理函数 async function handleRequest(request, env) { // 从环境变量获取配置 const default_upstream = env.ONEAPI_UPSTREAM const deepseek_upstream = env.DEEPSEEK_UPSTREAM const upstream_path = '/' const upstream_mobile = default_upstream const blocked_region = [] const blocked_ip_address = ['0.0.0.0', '127.0.0.1'] const https = true const disable_cache = false // 从环境变量获取 API Keys const VALID_ORIGINAL_API_KEY = env.VALID_ORIGINAL_API_KEY const DEEPSEEK_API_KEY = env.DEEPSEEK_API_KEY const region = request.headers.get('cf-ipcountry'); const upper_region = region ? region.toUpperCase() : ''; const ip_address = request.headers.get('cf-connecting-ip'); const user_agent = request.headers.get('user-agent'); let response = null; let url = new URL(request.url); let url_hostname = url.hostname; let isDeepseekRequest = false; let originalModel = ''; if (request.method === 'POST') { const contentType = request.headers.get('content-type'); if (contentType \u0026\u0026 contentType.includes('application/json')) { try { const clonedRequest = request.clone(); const body = await clonedRequest.json(); const originalApiKey = request.headers.get('authorization')?.replace('Bearer ', '').trim() || ''; if (originalApiKey === VALID_ORIGINAL_API_KEY \u0026\u0026 body.model \u0026\u0026 typeof body.model === 'string' \u0026\u0026 (body.model.startsWith('deepseek') || body.model.startsWith('my-deepseek'))) { isDeepseekRequest = true; originalModel = body.model; } } catch (error) { } } } if (https == true) { url.protocol = 'https:'; } else { url.protocol = 'http:'; } let upstream_domain; if (isDeepseekRequest) { upstream_domain = deepseek_upstream; } else if (await device_status(user_agent)) { upstream_domain = default_upstream; } else { upstream_domain = upstream_mobile; } url.host = upstream_domain; if (url.pathname == '//' || url.pathname == '/') { url.pathname = upstream_path; } else { if (isDeepseekRequest) { url.pathname = '/v1/chat/completions'; } else { url.pathname = upstream_path + url.pathname; } } if (blocked_region.includes(upper_region)) { response = new Response('Access denied: WorkersProxy is not available in your region yet.', { status: 403 }); } else if (blocked_ip_address.includes(ip_address)) { response = new Response('Access denied: Your IP address is blocked by WorkersProxy.', { status: 403 }); } else { let method = request.method; if (method === 'POST') { const contentType = request.headers.get('content-type'); if (contentType \u0026\u0026 contentType.includes('application/json')) { let body = await request.json(); if (body.model \u0026\u0026 typeof body.model === 'string') { if (isDeepseekRequest) { if (originalModel.startsWith('my-deepseek')) { body.model = originalModel.replace('my-deepseek', 'deepseek'); } } else { body.model = body.model.replace('my-cld', 'claude'); } } const headers = new Headers(); for (const [key, value] of request.headers.entries()) { headers.set(key.toLowerCase(), value); } if (isDeepseekRequest) { headers.set('authorization', `Bearer ${DEEPSEEK_API_KEY}`); } headers.set('content-type', 'application/json'); let original_response = await fetch(url.href, { method: method, headers: headers, body: JSON.stringify(body) }); let original_response_clone = original_response.clone(); let original_text = null; let response_headers = original_response.headers; let new_response_headers = new Headers(response_headers); let status = original_response.status; if (disable_cache) { new_response_headers.set('Cache-Control', 'no-store'); } new_response_headers.set('access-control-allow-origin', '*'); new_response_headers.set('access-control-allow-credentials', 'true'); new_response_headers.delete('content-security-policy'); new_response_headers.delete('content-security-policy-report-only'); new_response_headers.delete('clear-site-data'); if (new_response_headers.get(\"x-pjax-url\")) { new_response_headers.set(\"x-pjax-url\", response_headers.get(\"x-pjax-url\").replace(\"//\" + upstream_domain, \"//\" + url_hostname)); } const content_type = new_response_headers.get('content-type'); if (content_type != null \u0026\u0026 content_type.includes('text/html') \u0026\u0026 content_type.includes('UTF-8')) { original_text = await replace_response_text(original_response_clone, upstream_domain, url_hostname); } else { original_text = original_response_clone.body; } response = new Response(original_text, { status, headers: new_response_headers }); } else { response = await fetch(request); } } else { response = await fetch(request); } } return response; } async function replace_response_text(response, upstream_domain, host_name) { let text = await response.text() var i, j; for (i in replace_dict) { j = replace_dict[i] if (i == '$upstream') { i = upstream_domain } else if (i == '$custom_domain') { i = host_name } if (j == '$upstream') { j = upstream_domain } else if (j == '$custom_domain') { j = host_name } let re = new RegExp(i, 'g') text = text.replace(re, j); } return text; } async function device_status(user_agent_info) { var agents = [\"Android\", \"iPhone\", \"SymbianOS\", \"Windows Phone\", \"iPad\", \"iPod\"]; var flag = true; for (var v = 0; v \u003c agents.length; v++) { if (user_agent_info.indexOf(agents[v]) \u003e 0) { flag = false; break; } } return flag; } const replace_dict = { '$upstream': '$custom_domain', }; 配置说明 在 Cloudflare Workers 中配置的环境变量：\nONEAPI_UPSTREAM: 你的第三方api代理地址，如：api.yourdomain.com\n类型：普通文本 示例：api.yourdomain.com DEEPSEEK_UPSTREAM: 你的deepseek代理地址，如：api.deepseek.com\n类型：普通文本 示例：api.deepseek.com VALID_ORIGINAL_API_KEY: 你的第三方api的 API key\n类型：加密文本（Secret） 示例：sk-xxxxxxxxxxxxxxxxxxxxxxxx DEEPSEEK_API_KEY: 你的 Deepseek API key\n类型：加密文本（Secret） 示例：sk-xxxxxxxxxxxxxxxxxxxxxxxx 安全提示：将 API Keys 存储为加密的环境变量可以：\n防止密钥意外泄露到代码库中 方便进行密钥轮换 在日志中自动隐藏敏感信息 符合安全最佳实践 4. 验证配置 部署完成后，你可以使用以下 curl 命令验证配置是否正常：\n# 测试 Claude 模型 curl https://your-worker.workers.dev/v1/chat/completions -H \"Content-Type: application/json\" -H \"Authorization: Bearer sk-oriapikey\" -d '{ \"messages\": [ { \"role\": \"system\", \"content\": \"You are a test assistant.\" }, { \"role\": \"user\", \"content\": \"1+1=?\" } ], \"model\": \"my-cld-3-5-sonnet-latest\" }' # 测试 Deepseek 模型 curl https://your-worker.workers.dev/v1/chat/completions -H \"Content-Type: application/json\" -H \"Authorization: Bearer sk-oriapikey\" -d '{ \"messages\": [ { \"role\": \"system\", \"content\": \"You are a test assistant.\" }, { \"role\": \"user\", \"content\": \"1+1=?\" } ], \"model\": \"my-deepseek-coder\" }' 5. 在 Cursor 中配置 打开 Cursor 设置 找到 AI 设置部分 在 OpenAI API Key 中填入你配置的 VALID_ORIGINAL_API_KEY 在 API URL 中填入 https://your-worker.workers.dev/v1 重要说明：在 Cursor 中点击验证按钮可能会显示 “Invalid openai api key” 的错误提示，这是正常现象，不会影响实际使用。只要你在上一步（步骤4）中使用 curl 命令验证通过，就可以正常在 Cursor 的聊天界面中使用各个模型。这是因为 Cursor 的验证机制直接检查 OpenAI 的 API，而我们使用的是代理服务。\n模型映射说明 本配置支持以下模型映射：\nmy-cld-* → claude-*：所有以 my-cld 开头的模型名称会被自动映射到对应的 Claude 模型 my-deepseek-* → deepseek-*：所有以 my-deepseek 开头的模型名称会被自动映射到对应的 Deepseek 模型 例如：\nmy-cld-3-5-sonnet-latest → claude-3-5-sonnet-latest my-deepseek-coder → deepseek-coder 常见问题排查 如果遇到 403 错误：\n检查 API key 是否正确配置 确认 IP 和地区是否在屏蔽列表中 如果遇到模型不可用：\n确认模型名称是否正确映射 检查 第三方api 是否支持该模型 验证 Deepseek API key 是否有效 如果遇到连接问题：\n确认 Worker 是否正常部署 检查 upstream 地址是否正确配置 验证网络连接是否正常 注意事项 请确保你的 API Key 安全，不要泄露给他人 建议定期更换 API Key 如果使用频率较高，请注意 Cloudflare Worker 的使用配额 建议在正式使用前进行充分的测试验证 如果你需要任何帮助或遇到问题，欢迎提出反馈。\n","wordCount":"940","inLanguage":"en","datePublished":"2024-11-11T11:44:57+08:00","dateModified":"2024-11-11T11:44:57+08:00","author":{"@type":"Person","name":"Shawn"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://shenghairong.github.io/posts/2024-11-11-oneapi_cursor/"},"publisher":{"@type":"Organization","name":"Shawn's Blog","logo":{"@type":"ImageObject","url":"https://shenghairong.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://shenghairong.github.io/ accesskey=h title="Shawn's Blog (Alt + H)"><img src=https://shenghairong.github.io/favicon.ico alt aria-label=logo height=35>Shawn's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://shenghairong.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://shenghairong.github.io/archive/ title=Archive><span>Archive</span></a></li><li><a href=https://shenghairong.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://shenghairong.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://shenghairong.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://shenghairong.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">通过CF Worker代理第三方api在Cursor中使用Claude</h1><div class=post-meta><span title='2024-11-11 11:44:57 +0800 CST'>November 11, 2024</span>&nbsp;·&nbsp;940 words&nbsp;·&nbsp;Shawn</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%9c%a8-cursor-%e4%b8%ad%e4%bd%bf%e7%94%a8-cloudflare-worker-%e4%bb%a3%e7%90%86%e4%bb%a5%e7%ac%ac%e4%b8%89%e6%96%b9api%e7%9a%84%e6%96%b9%e5%bc%8f%e8%ae%bf%e9%97%ae-claude-%e6%95%99%e7%a8%8b aria-label="在 Cursor 中使用 Cloudflare Worker 代理以第三方api的方式访问 Claude 教程">在 Cursor 中使用 Cloudflare Worker 代理以第三方api的方式访问 Claude 教程</a><ul><li><a href=#%e5%8a%9f%e8%83%bd%e7%89%b9%e7%82%b9 aria-label=功能特点>功能特点</a></li><li><a href=#%e8%af%a6%e7%bb%86%e6%ad%a5%e9%aa%a4 aria-label=详细步骤>详细步骤</a><ul><li><a href=#1-%e5%88%9b%e5%bb%ba-cloudflare-worker aria-label="1. 创建 Cloudflare Worker">1. 创建 Cloudflare Worker</a></li><li><a href=#2-%e9%85%8d%e7%bd%ae%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f aria-label="2. 配置环境变量">2. 配置环境变量</a></li><li><a href=#3-%e9%85%8d%e7%bd%ae-worker-%e4%bb%a3%e7%a0%81 aria-label="3. 配置 Worker 代码">3. 配置 Worker 代码</a><ul><li><a href=#%e9%85%8d%e7%bd%ae%e8%af%b4%e6%98%8e aria-label=配置说明>配置说明</a></li></ul></li><li><a href=#4-%e9%aa%8c%e8%af%81%e9%85%8d%e7%bd%ae aria-label="4. 验证配置">4. 验证配置</a></li><li><a href=#5-%e5%9c%a8-cursor-%e4%b8%ad%e9%85%8d%e7%bd%ae aria-label="5. 在 Cursor 中配置">5. 在 Cursor 中配置</a></li></ul></li><li><a href=#%e6%a8%a1%e5%9e%8b%e6%98%a0%e5%b0%84%e8%af%b4%e6%98%8e aria-label=模型映射说明>模型映射说明</a></li><li><a href=#%e5%b8%b8%e8%a7%81%e9%97%ae%e9%a2%98%e6%8e%92%e6%9f%a5 aria-label=常见问题排查>常见问题排查</a></li><li><a href=#%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9 aria-label=注意事项>注意事项</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=在-cursor-中使用-cloudflare-worker-代理以第三方api的方式访问-claude-教程>在 Cursor 中使用 Cloudflare Worker 代理以第三方api的方式访问 Claude 教程<a hidden class=anchor aria-hidden=true href=#在-cursor-中使用-cloudflare-worker-代理以第三方api的方式访问-claude-教程>#</a></h1><p>本教程将指导你如何通过 Cloudflare Worker 在 Cursor 中以第三方api的方式访问 Claude 和 Deepseek 模型。通过覆盖 OpenAI 的 URL 地址，我们可以使用 第三方api 来访问这些模型。</p><h2 id=功能特点>功能特点<a hidden class=anchor aria-hidden=true href=#功能特点>#</a></h2><ol><li>支持 OpenAI 的 GPT 模型</li><li>支持将请求中的 &lsquo;my-cld&rsquo; 改写为 &lsquo;claude&rsquo;（通过 第三方api 代理地址）</li><li>支持将请求中的 &lsquo;my-deepseek&rsquo; 改写为 &lsquo;deepseek&rsquo;（直接通过 Deepseek 官方 API）</li></ol><h2 id=详细步骤>详细步骤<a hidden class=anchor aria-hidden=true href=#详细步骤>#</a></h2><h3 id=1-创建-cloudflare-worker>1. 创建 Cloudflare Worker<a hidden class=anchor aria-hidden=true href=#1-创建-cloudflare-worker>#</a></h3><ol><li>登录到 <a href=https://dash.cloudflare.com>Cloudflare Dashboard</a></li><li>在左侧菜单中选择 &ldquo;Workers & Pages&rdquo;</li><li>点击 &ldquo;Create Application&rdquo;</li><li>选择 &ldquo;Create Worker&rdquo;</li><li>为你的 Worker 命名，然后点击 &ldquo;Deploy&rdquo;</li><li>进入 Worker 编辑界面</li></ol><h3 id=2-配置环境变量>2. 配置环境变量<a hidden class=anchor aria-hidden=true href=#2-配置环境变量>#</a></h3><ol><li><p>在 Cloudflare Dashboard 中：</p><ul><li>进入你的 Worker 的设置页面</li><li>点击 &ldquo;Settings&rdquo; 选项卡</li><li>找到 &ldquo;Variables&rdquo; 部分</li><li>点击 &ldquo;Add variable&rdquo; 按钮</li></ul></li><li><p>添加以下环境变量：</p><ul><li><code>ONEAPI_UPSTREAM</code>: 你的 第三方api 代理地址</li><li><code>DEEPSEEK_UPSTREAM</code>: deepseek 代理地址, 官方为 api.deepseek.com</li><li><code>VALID_ORIGINAL_API_KEY</code>: 你的 第三方api key</li><li><code>DEEPSEEK_API_KEY</code>: 你的 Deepseek API key</li></ul></li><li><p>对于包含敏感信息的变量（API Keys），确保：</p><ul><li>点击 &ldquo;Encrypt&rdquo; 选项</li><li>设置类型为 &ldquo;Secret text&rdquo;</li></ul></li></ol><h3 id=3-配置-worker-代码>3. 配置 Worker 代码<a hidden class=anchor aria-hidden=true href=#3-配置-worker-代码>#</a></h3><p>将以下代码复制到 Worker 中：<div class=collapse-wrapper><button class=collapse-button onclick='this.parentElement.classList.toggle("active")'>
点击查看
<span class=collapse-icon>▼</span></button><div class=collapse-content><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>request</span>, <span style=color:#a6e22e>env</span>, <span style=color:#a6e22e>ctx</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>handleRequest</span>(<span style=color:#a6e22e>request</span>, <span style=color:#a6e22e>env</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 主要处理函数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleRequest</span>(<span style=color:#a6e22e>request</span>, <span style=color:#a6e22e>env</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 从环境变量获取配置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>default_upstream</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>ONEAPI_UPSTREAM</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>deepseek_upstream</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DEEPSEEK_UPSTREAM</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>upstream_path</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>upstream_mobile</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>default_upstream</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>blocked_region</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>blocked_ip_address</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;0.0.0.0&#39;</span>, <span style=color:#e6db74>&#39;127.0.0.1&#39;</span>]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>https</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>disable_cache</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 从环境变量获取 API Keys
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>VALID_ORIGINAL_API_KEY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>VALID_ORIGINAL_API_KEY</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>DEEPSEEK_API_KEY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DEEPSEEK_API_KEY</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>region</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;cf-ipcountry&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>upper_region</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>region</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>region</span>.<span style=color:#a6e22e>toUpperCase</span>() <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ip_address</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;cf-connecting-ip&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>user_agent</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;user-agent&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URL</span>(<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>url</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>url_hostname</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>hostname</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>isDeepseekRequest</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>originalModel</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>method</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;POST&#39;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>contentType</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;content-type&#39;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>contentType</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>contentType</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#e6db74>&#39;application/json&#39;</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>clonedRequest</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>clone</span>();
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>body</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>clonedRequest</span>.<span style=color:#a6e22e>json</span>();
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>originalApiKey</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;authorization&#39;</span>)<span style=color:#f92672>?</span>.<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#39;Bearer &#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>).<span style=color:#a6e22e>trim</span>() <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>originalApiKey</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>VALID_ORIGINAL_API_KEY</span> <span style=color:#f92672>&amp;&amp;</span> 
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>model</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>model</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;string&#39;</span> <span style=color:#f92672>&amp;&amp;</span> 
</span></span><span style=display:flex><span>                    (<span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>startsWith</span>(<span style=color:#e6db74>&#39;deepseek&#39;</span>) <span style=color:#f92672>||</span> <span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>startsWith</span>(<span style=color:#e6db74>&#39;my-deepseek&#39;</span>))) {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>isDeepseekRequest</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>originalModel</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>model</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) { }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>https</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>true</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>protocol</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;https:&#39;</span>;
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>protocol</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http:&#39;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>upstream_domain</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isDeepseekRequest</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>upstream_domain</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>deepseek_upstream</span>;
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>device_status</span>(<span style=color:#a6e22e>user_agent</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>upstream_domain</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>default_upstream</span>;
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>upstream_domain</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>upstream_mobile</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>host</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>upstream_domain</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>pathname</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;//&#39;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>pathname</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;/&#39;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>pathname</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>upstream_path</span>;
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isDeepseekRequest</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>pathname</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/v1/chat/completions&#39;</span>;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>pathname</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>upstream_path</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>pathname</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>blocked_region</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>upper_region</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Response</span>(<span style=color:#e6db74>&#39;Access denied: WorkersProxy is not available in your region yet.&#39;</span>, {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>403</span>
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>blocked_ip_address</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>ip_address</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Response</span>(<span style=color:#e6db74>&#39;Access denied: Your IP address is blocked by WorkersProxy.&#39;</span>, {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>403</span>
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>method</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>method</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>method</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;POST&#39;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>contentType</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;content-type&#39;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>contentType</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>contentType</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#e6db74>&#39;application/json&#39;</span>)) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>body</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>json</span>();
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>model</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>model</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;string&#39;</span>) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isDeepseekRequest</span>) {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>originalModel</span>.<span style=color:#a6e22e>startsWith</span>(<span style=color:#e6db74>&#39;my-deepseek&#39;</span>)) {
</span></span><span style=display:flex><span>                            <span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>model</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>originalModel</span>.<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#39;my-deepseek&#39;</span>, <span style=color:#e6db74>&#39;deepseek&#39;</span>);
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>model</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#39;my-cld&#39;</span>, <span style=color:#e6db74>&#39;claude&#39;</span>);
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>headers</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Headers</span>();
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>value</span>] <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>entries</span>()) {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>set</span>(<span style=color:#a6e22e>key</span>.<span style=color:#a6e22e>toLowerCase</span>(), <span style=color:#a6e22e>value</span>);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isDeepseekRequest</span>) {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;authorization&#39;</span>, <span style=color:#e6db74>`Bearer </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>DEEPSEEK_API_KEY</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;content-type&#39;</span>, <span style=color:#e6db74>&#39;application/json&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>original_response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>href</span>, {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>method</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>headers</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>body</span>)
</span></span><span style=display:flex><span>                });
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>original_response_clone</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>original_response</span>.<span style=color:#a6e22e>clone</span>();
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>original_text</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>response_headers</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>original_response</span>.<span style=color:#a6e22e>headers</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>new_response_headers</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Headers</span>(<span style=color:#a6e22e>response_headers</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>original_response</span>.<span style=color:#a6e22e>status</span>;
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>disable_cache</span>) {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>new_response_headers</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;Cache-Control&#39;</span>, <span style=color:#e6db74>&#39;no-store&#39;</span>);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>new_response_headers</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;access-control-allow-origin&#39;</span>, <span style=color:#e6db74>&#39;*&#39;</span>);
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>new_response_headers</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;access-control-allow-credentials&#39;</span>, <span style=color:#e6db74>&#39;true&#39;</span>);
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>new_response_headers</span>.<span style=color:#66d9ef>delete</span>(<span style=color:#e6db74>&#39;content-security-policy&#39;</span>);
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>new_response_headers</span>.<span style=color:#66d9ef>delete</span>(<span style=color:#e6db74>&#39;content-security-policy-report-only&#39;</span>);
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>new_response_headers</span>.<span style=color:#66d9ef>delete</span>(<span style=color:#e6db74>&#39;clear-site-data&#39;</span>);
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>new_response_headers</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;x-pjax-url&#34;</span>)) {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>new_response_headers</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#34;x-pjax-url&#34;</span>, <span style=color:#a6e22e>response_headers</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;x-pjax-url&#34;</span>).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#34;//&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>upstream_domain</span>, <span style=color:#e6db74>&#34;//&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>url_hostname</span>));
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>content_type</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>new_response_headers</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;content-type&#39;</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>content_type</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>content_type</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#e6db74>&#39;text/html&#39;</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>content_type</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#e6db74>&#39;UTF-8&#39;</span>)) {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>original_text</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>replace_response_text</span>(<span style=color:#a6e22e>original_response_clone</span>, <span style=color:#a6e22e>upstream_domain</span>, <span style=color:#a6e22e>url_hostname</span>);
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>original_text</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>original_response_clone</span>.<span style=color:#a6e22e>body</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Response</span>(<span style=color:#a6e22e>original_text</span>, {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>status</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>new_response_headers</span>
</span></span><span style=display:flex><span>                });
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>request</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>request</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>replace_response_text</span>(<span style=color:#a6e22e>response</span>, <span style=color:#a6e22e>upstream_domain</span>, <span style=color:#a6e22e>host_name</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>text</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>text</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>j</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#a6e22e>i</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>replace_dict</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>replace_dict</span>[<span style=color:#a6e22e>i</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>i</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;$upstream&#39;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>upstream_domain</span>
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>i</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;$custom_domain&#39;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>host_name</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>j</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;$upstream&#39;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>upstream_domain</span>
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>j</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;$custom_domain&#39;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>host_name</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>re</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> RegExp(<span style=color:#a6e22e>i</span>, <span style=color:#e6db74>&#39;g&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>text</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>text</span>.<span style=color:#a6e22e>replace</span>(<span style=color:#a6e22e>re</span>, <span style=color:#a6e22e>j</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>text</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>device_status</span>(<span style=color:#a6e22e>user_agent_info</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>agents</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;Android&#34;</span>, <span style=color:#e6db74>&#34;iPhone&#34;</span>, <span style=color:#e6db74>&#34;SymbianOS&#34;</span>, <span style=color:#e6db74>&#34;Windows Phone&#34;</span>, <span style=color:#e6db74>&#34;iPad&#34;</span>, <span style=color:#e6db74>&#34;iPod&#34;</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>flag</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>v</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>v</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>agents</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>v</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>user_agent_info</span>.<span style=color:#a6e22e>indexOf</span>(<span style=color:#a6e22e>agents</span>[<span style=color:#a6e22e>v</span>]) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>flag</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>flag</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>replace_dict</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;$upstream&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;$custom_domain&#39;</span>,
</span></span><span style=display:flex><span>};
</span></span></code></pre></div></div></div></p><h4 id=配置说明>配置说明<a hidden class=anchor aria-hidden=true href=#配置说明>#</a></h4><p>在 Cloudflare Workers 中配置的环境变量：</p><ol><li><p><code>ONEAPI_UPSTREAM</code>: 你的第三方api代理地址，如：<code>api.yourdomain.com</code></p><ul><li>类型：普通文本</li><li>示例：<code>api.yourdomain.com</code></li></ul></li><li><p><code>DEEPSEEK_UPSTREAM</code>: 你的deepseek代理地址，如：<code>api.deepseek.com</code></p><ul><li>类型：普通文本</li><li>示例：<code>api.deepseek.com</code></li></ul></li><li><p><code>VALID_ORIGINAL_API_KEY</code>: 你的第三方api的 API key</p><ul><li>类型：加密文本（Secret）</li><li>示例：<code>sk-xxxxxxxxxxxxxxxxxxxxxxxx</code></li></ul></li><li><p><code>DEEPSEEK_API_KEY</code>: 你的 Deepseek API key</p><ul><li>类型：加密文本（Secret）</li><li>示例：<code>sk-xxxxxxxxxxxxxxxxxxxxxxxx</code></li></ul></li></ol><blockquote><p><strong>安全提示</strong>：将 API Keys 存储为加密的环境变量可以：</p><ul><li>防止密钥意外泄露到代码库中</li><li>方便进行密钥轮换</li><li>在日志中自动隐藏敏感信息</li><li>符合安全最佳实践</li></ul></blockquote><h3 id=4-验证配置>4. 验证配置<a hidden class=anchor aria-hidden=true href=#4-验证配置>#</a></h3><p>部署完成后，你可以使用以下 curl 命令验证配置是否正常：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 测试 Claude 模型</span>
</span></span><span style=display:flex><span>curl https://your-worker.workers.dev/v1/chat/completions -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> -H <span style=color:#e6db74>&#34;Authorization: Bearer sk-oriapikey&#34;</span> -d <span style=color:#e6db74>&#39;{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;messages&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;role&#34;: &#34;system&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;content&#34;: &#34;You are a test assistant.&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;role&#34;: &#34;user&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;content&#34;: &#34;1+1=?&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ],
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;model&#34;: &#34;my-cld-3-5-sonnet-latest&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 测试 Deepseek 模型</span>
</span></span><span style=display:flex><span>curl https://your-worker.workers.dev/v1/chat/completions -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> -H <span style=color:#e6db74>&#34;Authorization: Bearer sk-oriapikey&#34;</span> -d <span style=color:#e6db74>&#39;{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;messages&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;role&#34;: &#34;system&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;content&#34;: &#34;You are a test assistant.&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;role&#34;: &#34;user&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;content&#34;: &#34;1+1=?&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ],
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;model&#34;: &#34;my-deepseek-coder&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}&#39;</span>
</span></span></code></pre></div><h3 id=5-在-cursor-中配置>5. 在 Cursor 中配置<a hidden class=anchor aria-hidden=true href=#5-在-cursor-中配置>#</a></h3><ol><li>打开 Cursor 设置</li><li>找到 AI 设置部分</li><li>在 OpenAI API Key 中填入你配置的 <code>VALID_ORIGINAL_API_KEY</code></li><li>在 API URL 中填入 <code>https://your-worker.workers.dev/v1</code></li></ol><blockquote><p><strong>重要说明</strong>：在 Cursor 中点击验证按钮可能会显示 &ldquo;Invalid openai api key&rdquo; 的错误提示，这是正常现象，不会影响实际使用。只要你在上一步（步骤4）中使用 curl 命令验证通过，就可以正常在 Cursor 的聊天界面中使用各个模型。这是因为 Cursor 的验证机制直接检查 OpenAI 的 API，而我们使用的是代理服务。</p></blockquote><h2 id=模型映射说明>模型映射说明<a hidden class=anchor aria-hidden=true href=#模型映射说明>#</a></h2><p>本配置支持以下模型映射：</p><ul><li><code>my-cld-*</code> → <code>claude-*</code>：所有以 <code>my-cld</code> 开头的模型名称会被自动映射到对应的 Claude 模型</li><li><code>my-deepseek-*</code> → <code>deepseek-*</code>：所有以 <code>my-deepseek</code> 开头的模型名称会被自动映射到对应的 Deepseek 模型</li></ul><p>例如：</p><ul><li><code>my-cld-3-5-sonnet-latest</code> → <code>claude-3-5-sonnet-latest</code></li><li><code>my-deepseek-coder</code> → <code>deepseek-coder</code></li></ul><h2 id=常见问题排查>常见问题排查<a hidden class=anchor aria-hidden=true href=#常见问题排查>#</a></h2><ol><li><p>如果遇到 403 错误：</p><ul><li>检查 API key 是否正确配置</li><li>确认 IP 和地区是否在屏蔽列表中</li></ul></li><li><p>如果遇到模型不可用：</p><ul><li>确认模型名称是否正确映射</li><li>检查 第三方api 是否支持该模型</li><li>验证 Deepseek API key 是否有效</li></ul></li><li><p>如果遇到连接问题：</p><ul><li>确认 Worker 是否正常部署</li><li>检查 upstream 地址是否正确配置</li><li>验证网络连接是否正常</li></ul></li></ol><h2 id=注意事项>注意事项<a hidden class=anchor aria-hidden=true href=#注意事项>#</a></h2><ol><li>请确保你的 API Key 安全，不要泄露给他人</li><li>建议定期更换 API Key</li><li>如果使用频率较高，请注意 Cloudflare Worker 的使用配额</li><li>建议在正式使用前进行充分的测试验证</li></ol><p>如果你需要任何帮助或遇到问题，欢迎提出反馈。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://shenghairong.github.io/tags/tutorial/>Tutorial</a></li></ul><nav class=paginav><a class=next href=https://shenghairong.github.io/posts/2024-11-10-hugo-gh_pages/><span class=title>Next »</span><br><span>免费使用 GitHub 私有仓库部署网站</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://shenghairong.github.io/>Shawn's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>